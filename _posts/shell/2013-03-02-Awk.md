---
layout: post
title: 文本处理神器sed与awk命令使用(续)
category: shell
tags: [shell, sed, awk]
keywords: shell, sed, awk
---

上一篇[传送门](http://gayyzxyx.github.com/shell/2013/02/24/Sed-And-Awk/)

## 概述：
awk功能与sed相似，都是处理文本的工具，但是awk的强大之处在于借助强大的语法支持处理格式化的文本，在处理没有规律的文本上面不及sed方便，术业有专攻吧。

## awk编程模型:

awk不能看作是一个shell命令了，更应该是一门编程语言。awk程序由一个主输入循环维持，其反复执行直到终止条件被触发。幸运的是awk的主循环框架无需我们去编写，已经搭建好了，我们只需要将写好的代码嵌入到循环框架中执行。awk有两个特殊的字段：BEGIN和END，BEGIN在主输入循环之前执行，即在未读取输入文件之前执行，END则恰好相反。总体看，awk程序的执行分为三个阶段：读输入文件之前的执行代码段（由BEGIN关键字标识）、读取输入文件时的执行代码段、读取输入文件之后的执行代码段（由END关键字标志）。

## awk的调用方法：
调用awk的方法与调用sed类似，也有三种方式：

1\.在shell命令行输入命令调用awk，格式为	

<pre>awk [-F 域分隔符] 'awk程序段' 输入文件   #需要用单引号将awk程序段引起来</pre>

2\.将awk程序段插入脚本文件，然后通过awk命令调用它，格式为

<pre>awk -f awk脚本文件 输入文件     #同sed命令类似也是通过-f选项表示调用脚本文件</pre>

3\.将sed命令插入脚本文件之后，最常用的方法是设置改脚本可执行，然后直接直接执行该脚本文件，格式为

<pre>./awk脚本文件 输入文件     #同样以#/awk路径来开头</pre>

### 1\.awk模式匹配

任何awk语句都是由模式(pattern)和动作(action)构成，模式测试输入行是否需要执行动作的规则(决定动作何时触发和触发事件)，动作是包含语句、函数和表达式的执行过程(执行对输入行的处理)，awk不仅支持所有正则表达式的元字符还支持"?"和"+"两个扩展元字符，而grep和sed并不支持，看awk的三种调用方法。

<pre>
root@core /home/awk# awk '/^$/{print "this is a blank line."}' input    #方法一调用awk打印空白行
this is a blank line.
this is a blank line.
this is a blank line.

root@core /home/awk# cat &gt; scr.awk   #创建scr.awk，执行命令
/^$/{print "this is a blank line."}
root@core /home/awk# awk -f scr.awk input   #方法二调用awk打印空白行
this is a blank line.
this is a blank line.
this is a blank line.

root@core /home/awk# cat  scr1.awk      #创建脚本
#!/usr/bin/awk -f
/^$/{print "this is a blank line."}
root@core /home/awk# chmod u+x scr1.awk    #赋予可执行权限
root@core /home/awk# ./scr1.awk input     #方法三调用awk打印空白行
this is a blank line.
this is a blank line.
this is a blank line.
</pre>

### 2\.记录和域

awk认为输入文件是结构化的，将每个输入行定义为记录，行中每一个字符串定义为域，域之间用空格、tab键或者其他符号进行分割。awk定义$来指定执行动作的域，如$1表示第一个域，$2表示第二个，$0则表示所有的域。有一个stu记录了学生信息，有四个域，分别用空格、tab、tab隔开如下：

<pre>
root@core /home/awk# awk '{print $2,$1,$3,$4}' stu   #依次打印第二个。第一个、第三个、第四个域
Hao Li njue 025-83481010
Ju Zhang nju 025-83466534
Bin Wang seu 025-83494883
Lin Zhu njupt 025-83680010

root@core /home/awk# awk '{print $0}' stu         #$0表示打印所有域
Li Hao  njue    025-83481010
Zhang Ju        nju     025-83466534
Wang Bin        seu     025-83494883
Zhu Lin njupt   025-83680010
</pre>

域操作符后面可以跟变量或者运算表达式，如下：

<pre>
root@core /home/awk# awk 'BEGIN {one=1;two=2}{print $(one+two)}' stu   #打印第三个域
njue
nju
seu
njupt
</pre>

可以用awk的`-F`选项来改变分隔符，awk的默认设置的分隔符是空格键，而tab键是被当做连续的空格符来处理。

<pre>
root@core /home/awk# awk -F"\t" '{print $3}' stu    #此时的第三个域则是电话号码那列
025-83481010
025-83466534
025-83494883
025-83680010
</pre>

awk还可以有另外一种方式来改变分隔符，那就是awk的环境变量FS，通过在BEGIN字段中设置FS值来改变分隔符。将stu记录中的tab制表符换成逗号

<pre>
root@core /home/awk# sed 's/\t/,/g' stu &gt; stu1
root@core /home/awk# mv stu1 stu
root@core /home/awk# awk 'BEGIN{FS=","}{print $0}' stu              #打印替换后的结果
Li Hao,njue,025-83481010
Zhang Ju,nju,025-83466534
Wang Bin,seu,025-83494883
Zhu Lin,njupt,025-83680010
</pre>

另外，可以利用正则表达式将分隔符设置为多个字符，如下:
(1)FS="\t"
(2)FS="\t+"
对于记录 wza\t\tcq，第一种将会把该记录解析为三个域：wza、空域、cq，第二种将其解析为两个域：wza和cq






